<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="bootstrap/css/bootstrap.css" />

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Sofia|Oswald"
    />
    <script src="bootstrap/js/bootstrap.js" defer></script>

    <!--I Couldn't achieve a search effect like I did on vanilla js using bootstrap so I reverted to vanilla js-->
    <script src="searchBar.js"></script>
    <title>Food and Drinks</title>
    <style>
      /*font-size decreasing cannot be done by bootstrap so I used @media*/
      @media screen and (max-width: 768px) {
        body {
          font-size: 0.8rem;
        }
        ul {
          font-size: 0.6rem;
        }
      }
      /*I couldn't achieve putting a background images using bootstrap so I added a bakground images using bootstrap*/
      .top-content {
        background-image: url(images/foods.jpg);
        background-size: cover;
        background-repeat: no-repeat;
        position: relative;
        bottom: 20px;
      }
      .food-info__content {
        display: none;
      }
    </style>
  </head>
  <body>
    <nav>
      <ul
        class="list-unstyled d-flex justify-content-around bg-dark text-light py-4"
      >
        <li class="nav-item px-auto">
          <a class="nav-link" href="home.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="explore.html">Explore</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="food_and_drinks.html">Food and Drinks</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="accommodations.html">Accommodations</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="contact.html">Contact</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="about_us.html">About</a>
        </li>
      </ul>
    </nav>
    <div class="top-content">
      <h1 class="text-center text-white py-5">Food and Drinks</h1>
      <div class="py-5">
        <div class="row gy-2 align-items-center justify-content-center w-100">
          <div class="col-12 col-lg-6">
            <input
              type="text"
              class="form-control py-3 rounded-5 food-search-input-js"
              placeholder="what countries food would you like to see"
              id="search"
            />
          </div>
          <div class="col-6 col-lg-2">
            <button class="btn btn-primary w-100 rounded-5 food-search-btn-js">
              <!-- onclick="showSearchedValue()" -->
              search
            </button>
          </div>
        </div>
      </div>
    </div>
    <section class="text-center" role="food information">
      <section class="foods-js">
        <ul class="food-info__content list-unstyled" id="Ethiopia">
          <h2>Ethiopia</h2>
          <hr />
          <li>
            <p>kitfo</p>
            <img
              class="rounded-5"
              src="images/Kitfo.jpg"
              alt="An image of kitfo; a traditional food in Ethiopia, made from grounded raw beef meat"
              width="200"
            />
            <p>Category: Foods</p>
          </li>
          <li class="food-info__content__item">
            <p>Tej</p>
            <img
              class="rounded-5"
              src="images/tej.jpg"
              alt="An image of a traditional alcoholic beverage in Ethiopia"
              width="200"
            />
            <p>Category: Drinks</p>
          </li>
          <li>
            <img
              class="rounded-5"
              src="images/doro_wot.jpg"
              alt="An image of Doro wot, a traditional food in Ethiopia, made from chicken"
              width="200"
            />
            <p class="food-info__content__item__text">Category: Food</p>
          </li>
          <li>
            <p>Shiro</p>
            <img
              class="rounded-5"
              src="images/shiro.jpg"
              alt="Shiro; a traditional food in Ethiopia"
              width="200"
            />
            <p>Category: Foods</p>
          </li>
        </ul>

        <ul class="food-info__content list-unstyled" id="Bali">
          <h2>Bali</h2>
          <hr />
          <li>
            <p>Babi Guling</p>
            <img
              class="rounded-5"
              src="images/babi_guling.jpg"
              alt="An image of babi guling; a traditional way of pig roast stuffed with spices found in bali"
              width="200"
            />
            <p>Category: Food</p>
          </li>
          <li>
            <p>Es cincau</p>
            <img
              class="rounded-5"
              src="images/Es_cincau.jpg"
              alt=" green grass jelly drink with ice, coconut milk and syrup."
              width="200"
            />
            <p>Category: Drinks</p>
          </li>
          <li>
            <p>Babi Guling</p>
            <img
              class="rounded-5"
              src="images/ayam_betutu.jpg"
              alt="dish of steamed or roasted chicken or duck"
              width="200"
            />
            <p>Category: Food</p>
          </li>
          <li>
            <p>Babi Guling</p>
            <img
              class="rounded-5"
              src="images/babi_guling.jpg"
              alt="An image of babi guling; a traditional way of pig roast stuffed with spices found in bali"
              width="200"
            />
            <p>Category: Food</p>
          </li>
        </ul>
        <ul class="food-info__content list-unstyled" id="Brazil">
          <h2>Brazil</h2>
          <hr />
          <li class="food-info__content__item">
            <p>Feijoada</p>
            <img
              class="rounded-5"
              src="images/Feijoada.jpg"
              alt=" A black bean and pork stew that is often served with farofa, toasted cassava "
              width="200"
            />
            <p class="food-info__content__item__text">Category: Foods</p>
          </li>
          <li>
            <p>Caipirnha</p>
            <img
              class="rounded-5"
              src="images/caipirnha.jpg"
              alt="Brazil's national cocktail, made with cachaÃ§a, sugar, and lime"
              width="200"
            />
            <p>Category: Drinks</p>
          </li>
          <li>
            <p>Moqueca</p>
            <img
              class="rounded-5"
              src="images/Moqueca.jpg"
              alt="An image of Moqueca; typically made with shrimp or fish as a base."
              width="200"
            />
            <p>Category: Food</p>
          </li>
          <li>
            <p>Deep fried pastel</p>
            <img
              class="rounded-5"
              src="images/Pastel.jpg"
              alt="An image of deep fried pastel"
              width="200"
            />
            <p>Category: Foods</p>
          </li>
        </ul>
      </section>
    </section>
    <script>
      const foodSearchBtn = document.querySelector(".food-search-btn-js");
      const foodSearchInput = document.querySelector(".food-search-input-js");
      const foodsSection = document.querySelector(".foods-js");

      foodSearchBtn.addEventListener("click", async () => {
        //if the front end already got the results, do nothing
        const frontAnswered = showSearchedValue();
        if (frontAnswered) return;

        const countryName = foodSearchInput.value;
        const lowerCase = countryName.toLowerCase();
        const countryFoods = await getCountryFoods(lowerCase);

        if (countryFoods) {
          foodsSection.innerHTML = ""; //remove whats inside
          foodsSection.appendChild(buildFoodsSection(countryFoods));
        } else {
          alert(`There are no search results for ${countryName}`);
        }
      });

      async function getCountryFoods(countryName) {
        const result = await fetch(`http://localhost:3000/`); //FIX THIS

        const data = result.json();
        const foods = data.foods; //FIX THIS
        if (foods) {
          return foods.map(formatFood);
        } else {
          return false;
        }
      }

      function getImageFolderPath() {
        const path = `../backend/uploads/images/additionalImages/`;
        return path;
      }

      function formatFood(originalFood) {
        const name = originalFood.name; //FIX THIS
        const imageName = originalFood.imageName; //FIX THIS
        const category = originalFood.category; //FIX THIS
        return { name, imageName, category };
      }

      function buildFoodsSection(countryName, foods) {
        const foodLis = "";
        for (const food of foods) {
          const { name, imageName, category } = food;
          const li = `
            <li>
              <p>${name}</p>
              <img
                src="${getImageFolderPath()}/${imageName}"
                alt="${name}"
                width="200"
              />
              <p>Category: ${category}</p>
          </li>`;
          foodLis += li;
        }

        const ul = `
          <ul>
            <h2>${countryName}</h2>
            <hr />
            ${foodLis}
          </ul>`;

        const domParser = new DOMParser();
        const realUl = domParser.parseFromString(divString, "text/html").body
          .firstElementChild;
        return realUl;
      }
    </script>
  </body>
</html>
